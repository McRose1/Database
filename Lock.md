# 数据库锁
为了保证数据的完整性和一致性，数据库系统采用锁来实现事务的隔离性。

从并发事务锁定的关系上看，可以分为共享锁定和独占锁定；

从锁定的对象不同，一把吗可以分为表锁定和行锁定

- 共享锁：非独占的，允许其他事务同时读取其锁定的资源，但不允许其他事务更新它，并发性很好
- 独占锁（排他锁）：适用于修改数据的场合。它所锁定的资源，其他事务不能读取也不能修改，并发性最差
- 更新锁：在初始阶段用来锁定可能要被改变的资源，这可以避免使用共享锁造成的死锁

当一个事务访问某种数据库资源时，如果执行 select 语句，必须先获得共享锁；

如果执行 insert、update 或 delete 语句，必须获得独占锁，这些锁用于锁定被操作的资源

当第二个事务也要访问相同的资源时，如果执行 select 语句，也必须先获得共享锁，如果执行 insert、update 或 delete 语句，也必须获得独占锁

此时根据已经旋转在资源上的锁的类型，来决定第二个事务应该等待第一个事务解除对应资源的锁定，还是可以立刻获得锁

| 资源上已经放置的锁 | 第二个事务进行读操作 | 第二个事务进行更新操作 |
| ----------- | ----------- |  ------------|
| 无 | 立即获得共享锁 | 立即获得独占锁 |
| 共享锁 | 立即获得共享锁 | 等待第一个事务解除共享锁 |
| 独占锁 | 等待第一个事务解除独占锁 | 等待第一个事务解除独占锁 |


- 表级:引擎 MyISAM, 理解为锁住整个表, 锁定期间, 其它进程无法对该表进行写操作, 如果是读锁, 其他进程可以同时读, 如果是写锁, 则其它进程则读也不允许
- 行级:引擎 INNODB, 单独的一行记录加锁, 其它进程还是可以对同一个表中的其它记录进行操作
- 页级:引擎 BDB, 表级锁速度快, 但冲突多, 行级冲突少, 但速度慢, 页级折衷, 一次锁定相邻的一组记录




